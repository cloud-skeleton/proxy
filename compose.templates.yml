---
services:
  # job:
  #   deploy:
  #     resources:
  #       limits:
  #         memory: 128M
  #   entrypoint: bash -c
  #   logging:
  #     driver: json-file
  #     options:
  #       max-file: 5
  #       max-size: 10m
  #   mem_swappiness: 0
  #   security_opt:
  #     - label:disable
  #   stop_grace_period: 30s
  #   user: root
  #   userns_mode: keep-id:uid=0,gid=0

  service:
    deploy:
      endpoint_mode: vip
      labels:
        eu.cloudskeleton.service: "true"
        eu.cloudskeleton.service.type: service
      mode: replicated
      placement:
        constraints:
          - node.labels.eu.cloudskeleton.node.type=main-worker
      replicas: 1
      resources:
        limits:
          cpus: 0.5
          memory: 128M
          pids: 1024
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 5
        window: 120s
      rollback_config:
        delay: 10s
        failure_action: continue
        max_failure_ratio: 0
        monitor: 60s
        order: start-first
        parallelism: 1
      update_config:
        delay: 10s
        failure_action: rollback
        max_failure_ratio: 0
        monitor: 60s
        order: start-first
        parallelism: 1


    # # entrypoint: !reset null
    # # extends: job
    # healthcheck:
    #   interval: 10s
    #   start_interval: 2s
    #   start_period: 10s
    #   timeout: 3s
    # init: true
    # logging:
    #   driver: json-file
    #   options:
    #     max-file: 5
    #     max-size: 10m
    # mem_swappiness: 0
    # restart: unless-stopped
    # security_opt:
    #   - label:disable
    # stop_grace_period: 30s
    # # user: !reset null
    # userns_mode: keep-id:uid=0,gid=0
...
